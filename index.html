<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>I Wandered Lonely as a Cloud</title>

    <script src="https://cdn.jsdelivr.net/gh/volumetrics-io/mrjs@latest/dist/mr.js"></script>
    <style>
        @font-face {
            font-family: 'Hepta Slab';
            src: url('./fonts/HeptaSlab-Regular.ttf') format('truetype');
            font-weight: 400;
        }

        @font-face {
            font-family: 'Hepta Slab';
            src: url('./fonts/HeptaSlab-Bold.ttf') format('truetype');
            font-weight: 700;
        }

        @font-face {
            font-family: 'Zilla Slab';
            src: url('./fonts/ZillaSlab-Medium.ttf') format('truetype');
            font-weight: 400;
        }

        @font-face {
            font-family: 'Zilla Slab';
            src: url('./fonts/ZillaSlab-Bold.ttf') format('truetype');
            font-weight: 700;
        }

        * {
            padding: 0;
            margin: 0;
            border: none;
            border-collapse: collapse;
        }

        html {
            overflow: hidden;
            overscroll-behavior: none;
        }

        body {
            position: fixed;
        }

        mr-surface {
            height: 100vh;
            width: 100vw;
        }

        mr-app * {
            display: block;
        }

        mr-column {
            height: 100%;
        }

        .mainContainer {
            background-color: rgba(255, 255, 255, 0.75);
            opacity: 1;
            border-radius: 50px;
            height: 60vh;
            width: 80vw;
        }

        .title {
            font-size: 48px;
            line-height: 100%;
            color: #333333;
            font-family: "Hepta Slab";
            font-weight: 700;
            text-align: center;
            margin-top: 60px;
        }

        .author {
            font-size: 18px;
            line-height: 100%;
            color: #333333;
            font-weight: 700;
            text-align: center;
            margin-top: 30px;
        }

        .paragraph {
            color: #333333;
            font-size: 24px;
            line-height: 200%;
            font-family: "Hepta Slab";
            font-weight: 400;
            /* width: 100%; */
            margin-top: 40px;
            /* margin-bottom: 20px; */
            text-align: center;
        }

        .paragraph-end {
            height: 200px;
        }

        .toolbar {
            background-color: hotpink;
            border-radius: 1%;
            height: 80px;
            width: 150px;
        }

        .button {
            text-align: left;
        }

        .daffodil {
            scale: 0.01;
            z-index: 0;
        }

        .logo {
            scale: 0.001;
            z-index: 10;
            height: 100px;
        }

        #debug {
            font-size: 36px;
            color: red;
        }

        #background {
            position: absolute;
            inset: 0;
            width: 100vw;
            height: 100vh;
            background-color: black;
            z-index: -1;
            display: block;
            object-fit: cover;
            object-position: center;
        }
    </style>

</head>
 
<body>
    <video id="background" src="/images/coffee_shop.mp4" playsinline="" autoplay="" muted="" loop=""></video>
    <mr-app debug="false" camera="camera: perspective">
        <mr-surface fixed="true">
            <mr-entity data-rotation="90 0 0" data-comp-animation="type: rotate; maxspeed: -0.002; acceleration: -0.000008;">
                <mr-model class="daffodil" height="0.1" data-position="1 0 0"
                    data-comp-animation="type: rotate; maxspeed: -0.002; acceleration: -0.000008;"
                    data-comp-instancing="type: animate"
                    src="./assets/daffodil.stl" data-rotation="0 180 0">
                </mr-model>
            </mr-entity>

            <!-- <mr-container class="mainContainer" data-rotation="-20 0 0" data-position="0 -0.1 0"> -->
            <mr-container class="mainContainer">
                <mr-column>
                    <mr-text class="title">I Wandered
                        Lonely as a Cloud</mr-text>
                    <mr-text class="author">by William Wordsworth</mr-text>
                    <mr-text class="paragraph">
                        I wandered lonely as a cloud
                        That floats on high o'er vales and hills,
                        When all at once I saw a crowd,
                        A host, of golden daffodils;
                    </mr-text>

                    <!-- <mr-entity data-rotation="90 0 0"
                        data-comp-animation="type: rotate; maxspeed: -0.002; acceleration: -0.000008;">
                        <mr-model class="logo" src="./assets/logo.stl"></mr-model>
                    </mr-entity> -->

                    <!-- <mr-img class="inlineImage" src="./images/placeholder.jpg"></mr-img> -->

                    <mr-model class="daffodil" data-position="-0.06 0 0" src="./assets/daffodil.stl"
                        data-rotation="0 90 0"></mr-model>

                    <mr-text class="paragraph">
                        Beside the lake, beneath the trees,
                        Fluttering and dancing in the breeze.
                        Continuous as the stars that shine
                        And twinkle on the milky way,
                    </mr-text>

                    <mr-entity data-position="0 0 0.025" data-rotation="90 0 0"
                        data-comp-animation="type: rotate; maxspeed: -0.002; acceleration: -0.000008;">
                        <mr-model class="logo" src="./assets/logo.stl"></mr-model>
                    </mr-entity>

                    <mr-text class="paragraph">
                        They stretched in never-ending line
                        Along the margin of a bay:
                        Ten thousand saw I at a glance,
                        Tossing their heads in sprightly dance.
                    </mr-text>

                    <mr-model class="daffodil" data-position="-0.06 0 0" src="./assets/daffodil.stl"
                        data-rotation="0 90 0"></mr-model>

                    <mr-text class="paragraph">
                        The waves beside them danced; but they
                        Out-did the sparkling waves in glee:
                        A poet could not but be gay,
                        In such a jocund company:
                    </mr-text>

                    <mr-entity data-position="0 0 0.025" data-rotation="90 0 0"
                        data-comp-animation="type: rotate; maxspeed: -0.002; acceleration: -0.000008;">
                        <mr-model class="logo" src="./assets/logo.stl"></mr-model>
                    </mr-entity>

                    <mr-text class="paragraph">
                        I gazed—and gazed—but little thought
                        What wealth the show to me had brought:
                        For oft, when on my couch I lie
                        In vacant or in pensive mood,
                    </mr-text>

                    <mr-model class="daffodil" data-position="-0.06 0 0" src="./assets/daffodil.stl"
                        data-rotation="0 90 0"></mr-model>

                    <mr-text class="paragraph">
                        They flash upon that inward eye
                        Which is the bliss of solitude;
                        And then my heart with pleasure fills,
                        And dances with the daffodils.
                    </mr-text>

                    <mr-entity data-position="0 0 0.025" data-rotation="90 0 0"
                        data-comp-animation="type: rotate; maxspeed: -0.002; acceleration: -0.000008;">
                        <mr-model class="logo" src="./assets/logo.stl"></mr-model>
                    </mr-entity>

                    <mr-text class="paragraph-end">
                        &nbsp;
                        &nbsp;
                        &nbsp;
                        &nbsp;
                    </mr-text>
                </mr-column>

            </mr-container>

            <!-- <mr-container data-position="-0.2 0 0.1" class="toolbar" data-rotation="-20 0 0"> -->
            <mr-container class="toolbar" data-position="-0.5 0 0.1" >
                <mr-text id="debug">0</mr-text>
            </mr-container>


        </mr-surface>

        <mr-sky id="sky0" data-texture="./skybox/black.jpg"></mr-sky>
        <mr-sky id="sky1" data-texture="./skybox/skydome01.jpg"></mr-sky>
        <mr-sky id="sky2" data-texture="./skybox/watercolor03.jpg"></mr-sky>
        <mr-sky id="sky3" data-texture="./skybox/skybox2.jpg"></mr-sky>

        <mr-light color="white" intensity="10" data-position="0 10 0.2"></mr-light>

        <mr-model id="island" data-position="0 -1 -2" src="./assets/island.glb" data-rotation="0 90 0" zoffset="0.05"
            scale="0.001">
        </mr-model>

    </mr-app>
</body>

<script type="module">
    class Sky extends Entity {
        constructor() {
            super();
            this.geometry = new THREE.SphereGeometry(16, 32, 16);

            const textureLoader = new THREE.TextureLoader();
            this.texture = textureLoader.load(this.dataset.texture);
            this.material = new THREE.MeshBasicMaterial({
                color: 0xdddddd,
                opacity: 0,
                side: 1,
                transparent: true,
                map: this.texture,
                needsUpdate: true
            });

            this.originOpacity = 0;
            this.goalOpacity = 0;

            this.object3D = new THREE.Mesh(this.geometry, this.material);
            // this.object3D.rotateY(90);
        }

        setOpacity(opacity) {
            this.originOpacity = this.material.opacity;
            this.goalOpacity = opacity;
        }

        opacityLoop() {
            if (Math.abs(this.goalOpacity - this.material.opacity) > 0.02) {
                if (this.goalOpacity > this.originOpacity) {
                    this.material.opacity += 0.05;
                } else {
                    this.material.opacity -= 0.05;
                }
            } else {
                this.material.opacity = this.goalOpacity;
            }

        }
    }
    customElements.define('mr-sky', Sky);

    class FadeSystem extends System {
        constructor() {
            super();
            this.skyboxes = document.querySelectorAll("mr-sky");

        }
        update(deltaTime, frame) {
            this.skyboxes.forEach(skybox => {
                skybox.opacityLoop()
            });
        }
    }

    var fade = new FadeSystem();
</script>

<script src="./scripts/AnimationSystem.js"></script>
<script src="./scripts/InstancingWithModsSystem.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", (event) => {
        console.log("DOM fully loaded and parsed");

        const skybox0 = document.querySelector("#sky0");
        const skybox1 = document.querySelector("#sky1");
        const skybox2 = document.querySelector("#sky2");
        const skybox3 = document.querySelector("#sky3");
        skybox0.setOpacity(0);
        skybox1.setOpacity(0);
        skybox2.setOpacity(0);
        skybox3.setOpacity(0);

        const container = document.querySelector("mr-container");
        let textureLoader = new THREE.TextureLoader();
        container.background.material.opacity = 0.5;

        const island = document.querySelector("#island");
        island.object3D.position.z = -2;
        island.object3D.rotation.y = 90;

        container.addEventListener("touch", (event) => {
            const position = container.shuttle.position.y

            const island = document.querySelector("#island");
            island.object3D.position.z = position * 2 - 2;
            island.object3D.rotation.y = -1 * position + 90;
            // How do we change the opacity of the island?
            island.opacity = -1 + position;
            // island.object3D.scale.setScalar(position);

            if (container.shuttle.position.y < 0.025) {
                skybox0.setOpacity(0);
                skybox1.setOpacity(0);
                skybox2.setOpacity(0);
                skybox3.setOpacity(0);
            } else if (container.shuttle.position.y < 0.05) {
                skybox0.setOpacity(0.5);
                skybox1.setOpacity(0);
                skybox2.setOpacity(0);
                skybox3.setOpacity(0);
            } else if (container.shuttle.position.y < 0.125) {
                skybox0.setOpacity(0.5);
                skybox1.setOpacity(1);
                skybox2.setOpacity(0);
                skybox3.setOpacity(0);
            } else if (container.shuttle.position.y < 0.3) {
                skybox0.setOpacity(0.5);
                skybox1.setOpacity(1);
                skybox2.setOpacity(1);
                skybox3.setOpacity(0);
            } else if (container.shuttle.position.y < 0.6) {
                skybox0.setOpacity(0.5);
                skybox1.setOpacity(1);
                skybox2.setOpacity(1);
                skybox3.setOpacity(1);
            } else if (container.shuttle.position.y < 1.2) {
                skybox0.setOpacity(0.5);
                skybox1.setOpacity(0);
                skybox2.setOpacity(0);
                skybox3.setOpacity(0);
            } else {
                skybox0.setOpacity(0);
                skybox1.setOpacity(0);
                skybox2.setOpacity(0);
                skybox3.setOpacity(0);
            }

            const debug = document.querySelector("#debug");
            debug.innerText = Math.round(container.shuttle.position.y * 100) / 100;
        })
    });
</script>

</html>
