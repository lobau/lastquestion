<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MR.js</title>
    <meta name="description" content="MR.js example">

    <script src="https://cdn.jsdelivr.net/gh/volumetrics-io/mrjs@latest/dist/build.js"></script>
    <style>
        @font-face {
            font-family: 'Archia';
            src: url('./fonts/Archia-Regular.otf') format('opentype');
            font-weight: 400;
        }

        @font-face {
            font-family: 'Archia';
            src: url('./fonts/Archia-Bold.otf') format('opentype');
            font-weight: 700;
        }

        @font-face {
            font-family: 'Hepta Slab';
            src: url('./fonts/HeptaSlab-Regular.ttf') format('truetype');
            font-weight: 400;
        }

        @font-face {
            font-family: 'Hepta Slab';
            src: url('./fonts/HeptaSlab-Bold.ttf') format('truetype');
            font-weight: 700;
        }


        * {
            padding: 0;
            margin: 0;
            border: none;
            border-collapse: collapse;
        }

        html {
            overflow: hidden;
            overscroll-behavior: none;
        }

        body {
            position: fixed;
        }

        mr-surface {
            height: 100vh;
            width: 100vw;
        }


        mr-text {
            margin: 20px;
            font-size: 36px;
            line-height: 200%;
            font-family: "Hepta Slab";
            font-weight: 400;
            color: white;
        }

        .title {
            font-size: 5vw;
            line-height: 100%;
            /* color: rgba(24, 24, 24, 0.75); */
            color: white;
            font-weight: 900;
            text-align: center;

        }

        author {
            font-family: serif;
        }

        mr-app * {
            display: block;
        }

        .mainContainer {
            /* background-color: rgba(255, 255, 255, 0.5); */
            border-radius: 2%;
            height: 100vh;
            width: 100vw;
        }

        .toolbar {
            background-color: hotpink;
            border-radius: 2%;
            height: 10vh;
            width: 10vw;
        }

        .button {
            text-align: left;
        }

        mr-row {
            height: 100%;
            width: 100%;
        }

        mr-column {
            height: 100%;
        }

        .main {
            background-color: var(--color-paper);
            border-radius: 2%;
            padding: 10px;
            max-width: 80%;
            margin: auto;
        }

        .daffodil {
            scale: 0.03;
            z-index: 120;
        }

        .other {
            scale: 0.0003;
            z-index: 100;
        }
    </style>

</head>

<body>
    <mr-app debug="false" camera="camera: perspective" layers="0 1 2 3">
        <mr-surface fixed="true" rotation="-30 0 0" position="0 -0.5 0">
            <mr-entity rotation="90 0 0" comp-animation="type: rotate; maxspeed: -0.002; acceleration: -0.000008;">
                <mr-model class="daffodil" height="0.1" layer="2" position="1 0 0"
                    comp-animation="type: rotate; maxspeed: -0.002; acceleration: -0.000008;"
                    src="./assets/daffodil.stl" rotation="0 180 0">
                </mr-model>
            </mr-entity>

            <mr-container class="mainContainer">
                <mr-column class="main">
                    <mr-text class="title">I Wandered</mr-text>
                    <mr-text class="title">Lonely as a Cloud</mr-text>
                    <mr-text class="author">by William Wordsworth</mr-text>
                    <mr-text>
                        I wandered lonely as a cloud
                        That floats on high o'er vales and hills,
                        When all at once I saw a crowd,
                        A host, of golden daffodils;
                        Beside the lake, beneath the trees,
                        Fluttering and dancing in the breeze.
                    </mr-text>

                    <mr-model class="daffodil" height="0.1" layer="2" position="0 0 0" src="./assets/daffodil.stl"
                        rotation="0 90 0">
                    </mr-model>

                    <mr-text>
                        Continuous as the stars that shine
                        And twinkle on the milky way,
                        They stretched in never-ending line
                        Along the margin of a bay:
                        Ten thousand saw I at a glance,
                        Tossing their heads in sprightly dance.
                    </mr-text>

                    <mr-model class="daffodil" height="0.1" layer="2" position="0 0 0" src="./assets/daffodil.stl"
                        rotation="0 90 0">
                    </mr-model>

                    <mr-text>
                        The waves beside them danced; but they
                        Out-did the sparkling waves in glee:
                        A poet could not but be gay,
                        In such a jocund company:
                        I gazed—and gazed—but little thought
                        What wealth the show to me had brought:
                    </mr-text>

                    <mr-model class="daffodil" height="0.1" layer="2" position="0 0 0" src="./assets/daffodil.stl"
                        rotation="0 90 0">
                    </mr-model>

                    <mr-text>
                        For oft, when on my couch I lie
                        In vacant or in pensive mood,
                        They flash upon that inward eye
                        Which is the bliss of solitude;
                        And then my heart with pleasure fills,
                        And dances with the daffodils.
                    </mr-text>
                </mr-column>

            </mr-container>

            <mr-container position="-0.5 0 0.001" class="toolbar">
                <mr-text id="debug">test</mr-text>
            </mr-container>
        </mr-surface>

        <mr-sky id="sky1" data-texture="./skybox/skybox1.jpg"></mr-sky>
        <mr-sky id="sky2" data-texture="./skybox/skybox2.jpg"></mr-sky>

        <mr-model id="island" layer="2" position="0 -3 -5" src="./assets/island.stl" rotation="-90 0 90" zoffset="0.05"
            scale="0.001">
        </mr-model>

    </mr-app>
</body>

<script>
window.onload = () => {
        const container = document.querySelector("mr-container");
        container.addEventListener("touch", (event) => {
            const position = container.shuttle.position.y

            const island = document.querySelector("#island");
            island.object3D.position.z = position * 10 - 5;

            const skybox1 = document.querySelector("#sky1");
            const skybox2 = document.querySelector("#sky2");
            // island.object3D.scale.setScalar(position);

            console.log(skybox1)

            if (container.shuttle.position.y > 0.3) {
                skybox1.material.opacity = 1;
                skybox2.material.opacity = 0;
                // this.material.map = this.texture2;
                
                // this.material.opacity = 1;
            } else {
                skybox1.material.opacity = 0;
                skybox2.material.opacity = 1;
                // this.material.map = this.texture1;
                // this.material.opacity = 1 - this.container.shuttle.position.y;
            }

            const debug = document.querySelector("#debug");
            debug.innerText = Math.round(container.shuttle.position.y * 100) / 100;
        })
    }
</script>

<script type="module">
    class Sky extends Entity {
        constructor() {
            super();
            this.geometry = new THREE.SphereGeometry(16, 32, 16);

            // Load the image texture
            const textureLoader = new THREE.TextureLoader();
            this.texture = textureLoader.load(this.dataset.texture);

            // Apply the texture to the material's map property
            // Create a basic material without specifying color
            // this.material = new THREE.MeshBasicMaterial();
            this.material = new THREE.MeshBasicMaterial({
                color: 0xdddddd,
                opacity: 0,
                side: 1,
                transparent: true,
                map: this.texture
            });

            // Update the material to reflect changes
            this.material.needsUpdate = true;

            this.object3D = new THREE.Mesh(this.geometry, this.material);
        }
    }
    customElements.define('mr-sky', Sky);
</script>

<script src="./scripts/AnimationSystem.js"></script>

</html>