<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>I Wandered Lonely as a Cloud</title>

    <script src="https://cdn.jsdelivr.net/gh/volumetrics-io/mrjs@latest/dist/mr.js"></script>
    <style>
        @font-face {
            font-family: 'Hepta Slab';
            src: url('./fonts/HeptaSlab-Regular.ttf') format('truetype');
            font-weight: 400;
        }

        @font-face {
            font-family: 'Hepta Slab';
            src: url('./fonts/HeptaSlab-Bold.ttf') format('truetype');
            font-weight: 700;
        }

        /* @font-face {
            font-family: 'Archia';
            src: url('./fonts/Archia-Bold.otf') format('opentype');
            font-weight: 700;
        } */

        @font-face {
            font-family: 'Zilla Slab';
            src: url('./fonts/ZillaSlab-Medium.ttf') format('truetype');
            font-weight: 400;
        }

        @font-face {
            font-family: 'Zilla Slab';
            src: url('./fonts/ZillaSlab-Bold.ttf') format('truetype');
            font-weight: 700;
        }


        * {
            padding: 0;
            margin: 0;
            border: none;
            border-collapse: collapse;
        }

        html {
            overflow: hidden;
            overscroll-behavior: none;
        }

        body {
            position: fixed;
        }

        mr-surface {
            height: 100vh;
            width: 100vw;
        }

        mr-app * {
            display: block;
        }

        mr-column {
            height: 100%;
        }

        .mainContainer {
            background-color: white;
            opacity: 1;
            border-radius: 10px;
            height: 500px;
            width: 720px;
        }

        .title {
            font-size: 48px;
            line-height: 100%;
            color: black;
            font-weight: 700;
            text-align: center;
            margin-top: 60px;
        }

        .author {
            font-size: 18px;
            line-height: 100%;
            color: black;
            font-weight: 700;
            text-align: center;
            margin-top: 20px;
        }

        .paragraph {
            color: white;
            font-size: 24px;
            line-height: 200%;
            font-family: "Zilla Slab";
            font-weight: 400;
            color: black;
            /* width: 100%; */
            margin-top: 40px;
            /* margin-bottom: 20px; */
            text-align: center;
        }

        .toolbar {
            background-color: hotpink;
            border-radius: 1%;
            height: 80px;
            width: 150px;
        }

        .button {
            text-align: left;
        }

        .daffodil {
            scale: 0.01;
            z-index: 0;
        }

        .logo {
            scale: 0.001;
            z-index: 10;
            height: 100px;
        }

        #debug {
            font-size: 36px;
            color: red;
        }
    </style>

</head>

<body>
    <mr-app debug="false" camera="camera: perspective">
        <mr-surface fixed="true">
            <mr-entity rotation="90 0 0" comp-animation="type: rotate; maxspeed: -0.002; acceleration: -0.000008;">
                <mr-model class="daffodil" height="0.1" position="1 0 0"
                    comp-animation="type: rotate; maxspeed: -0.002; acceleration: -0.000008;"
                    src="./assets/daffodil.stl" rotation="0 180 0">
                </mr-model>
            </mr-entity>

            <mr-container class="mainContainer" rotation="-20 0 0" position="0 -0.1 0">
                <mr-column>
                    <mr-text class="title">I Wandered
                        Lonely as a Cloud</mr-text>
                    <mr-text class="author">by William Wordsworth</mr-text>
                    <mr-text class="paragraph">
                        I wandered lonely as a cloud
                        That floats on high o'er vales and hills,
                        When all at once I saw a crowd,
                        A host, of golden daffodils;
                        Beside the lake, beneath the trees,
                        Fluttering and dancing in the breeze.
                    </mr-text>

                    <mr-entity rotation="90 0 0"
                        comp-animation="type: rotate; maxspeed: -0.002; acceleration: -0.000008;">
                        <mr-model class="logo" src="./assets/logo.stl"></mr-model>
                    </mr-entity>

                    <!-- <mr-img class="inlineImage" src="./images/placeholder.jpg"></mr-img> -->

                    <!-- <mr-model class="daffodil" position="0 0 -20" src="./assets/daffodil.stl"
                        rotation="0 90 0"></mr-model> -->

                    <mr-text class="paragraph">
                        Continuous as the stars that shine
                        And twinkle on the milky way,
                        They stretched in never-ending line
                        Along the margin of a bay:
                        Ten thousand saw I at a glance,
                        Tossing their heads in sprightly dance.
                    </mr-text>

                    <mr-model class="daffodil" height="0.1" position="0 0 0" src="./assets/daffodil.stl"
                        rotation="0 90 0">
                    </mr-model>

                    <mr-text class="paragraph">
                        The waves beside them danced; but they
                        Out-did the sparkling waves in glee:
                        A poet could not but be gay,
                        In such a jocund company:
                        I gazed—and gazed—but little thought
                        What wealth the show to me had brought:
                    </mr-text>

                    <mr-model class="daffodil" height="0.1" position="0 0 0" src="./assets/daffodil.stl"
                        rotation="0 90 0">
                    </mr-model>

                    <mr-text class="paragraph">
                        For oft, when on my couch I lie
                        In vacant or in pensive mood,
                        They flash upon that inward eye
                        Which is the bliss of solitude;
                        And then my heart with pleasure fills,
                        And dances with the daffodils.
                    </mr-text>
                </mr-column>

            </mr-container>

            <mr-container position="-0.2 0 0.1" class="toolbar" rotation="-20 0 0">
                <mr-text id="debug">0</mr-text>
            </mr-container>
        </mr-surface>

        <mr-sky id="sky0" data-texture="./skybox/black.jpg"></mr-sky>
        <mr-sky id="sky1" data-texture="./skybox/1700261476238.jpg"></mr-sky>
        <mr-sky id="sky2" data-texture="./skybox/skybox2.jpg"></mr-sky>

        <mr-light color="white" intensity="5" position="0 10 0"></mr-light>

        <mr-model id="island" layer="2" position="0 -3 -5" src="./assets/island.glb" rotation="0 90 0" zoffset="0.05"
            scale="0.001">
        </mr-model>

    </mr-app>
</body>

<script type="module">
    class Sky extends Entity {
        constructor() {
            super();
            this.geometry = new THREE.SphereGeometry(16, 32, 16);

            const textureLoader = new THREE.TextureLoader();
            this.texture = textureLoader.load(this.dataset.texture);
            this.material = new THREE.MeshBasicMaterial({
                color: 0xdddddd,
                opacity: 0,
                side: 1,
                transparent: true,
                map: this.texture,
                needsUpdate: true
            });

            this.originOpacity = 0;
            this.goalOpacity = 0;

            this.object3D = new THREE.Mesh(this.geometry, this.material);
        }

        setOpacity(opacity) {
            this.originOpacity = this.material.opacity;
            this.goalOpacity = opacity;
        }

        opacityLoop() {
            if (Math.abs(this.goalOpacity - this.material.opacity) > 0.02) {
                if (this.goalOpacity > this.originOpacity) {
                    this.material.opacity += 0.05;
                } else {
                    this.material.opacity -= 0.05;
                }
            } else {
                this.material.opacity = this.goalOpacity;
            }

        }
    }
    customElements.define('mr-sky', Sky);

    class FadeSystem extends System {
        constructor() {
            super();
            this.skyboxes = document.querySelectorAll("mr-sky");

        }
        update(deltaTime, frame) {
            this.skyboxes.forEach(skybox => {
                skybox.opacityLoop()
            });
        }
    }

    var fade = new FadeSystem();
</script>

<script src="./scripts/AnimationSystem.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", (event) => {
        console.log("DOM fully loaded and parsed");

        const skybox0 = document.querySelector("#sky0");
        const skybox1 = document.querySelector("#sky1");
        const skybox2 = document.querySelector("#sky2");
        skybox0.setOpacity(0);
        skybox1.setOpacity(0);
        skybox2.setOpacity(0);

        const container = document.querySelector("mr-container");
        let textureLoader = new THREE.TextureLoader();
        container.background.material.opacity = 0.5;


        container.addEventListener("touch", (event) => {
            const position = container.shuttle.position.y

            const island = document.querySelector("#island");
            island.object3D.position.z = position * 10 - 5;
            // island.object3D.scale.setScalar(position);

            if (container.shuttle.position.y < 0.05) {
                skybox0.setOpacity(0);
                skybox1.setOpacity(0);
                skybox2.setOpacity(0);
            } else if (container.shuttle.position.y < 0.1) {
                skybox0.setOpacity(0.5);
                skybox1.setOpacity(0);
                skybox2.setOpacity(0);
            } else if (container.shuttle.position.y < 0.3) {
                skybox0.setOpacity(0.5);
                skybox1.setOpacity(1);
                skybox2.setOpacity(0);
            } else if (container.shuttle.position.y < 0.6) {
                skybox0.setOpacity(0.5);
                skybox1.setOpacity(1);
                skybox2.setOpacity(1);
            } else {
                skybox0.setOpacity(0);
                skybox1.setOpacity(0);
                skybox2.setOpacity(0);
            }

            const debug = document.querySelector("#debug");
            debug.innerText = Math.round(container.shuttle.position.y * 100) / 100;
        })
    });
</script>

</html>